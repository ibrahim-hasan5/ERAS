<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complete Your Profile - ERAS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass-morphism {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    
    .gradient-border {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 2px;
      border-radius: 16px;
    }
    
    .gradient-border-content {
      background: white;
      border-radius: 14px;
      padding: 2rem;
    }
    
    .floating-animation {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .glow-effect {
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
    }
    
    .form-field {
      transition: all 0.3s ease;
    }
    
    .form-field:focus-within {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .sidebar-item {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .sidebar-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .sidebar-item:hover::before {
      left: 100%;
    }
    
    .progress-indicator {
      background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6, #ef4444);
      background-size: 400% 400%;
      animation: gradient-shift 8s ease infinite;
    }
    
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .pulse-ring {
      animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
    }
    
    @keyframes pulse-ring {
      0% {
        transform: scale(0.8);
        opacity: 1;
      }
      80%, 100% {
        transform: scale(1.2);
        opacity: 0;
      }
    }
    
    .section-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.4s ease;
    }
    
    .section-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .readonly-field {
      background: #f8fafc !important;
      color: #6b7280;
      cursor: not-allowed;
    }

    .locked-icon {
      color: #9ca3af;
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }

    .completion-status {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 12px;
    }

    .status-incomplete {
      background: #fef3c7;
      color: #d97706;
    }

    .status-complete {
      background: #d1fae5;
      color: #059669;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 font-inter text-gray-800 overflow-x-hidden">
  
  <!-- Animated Background Elements -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 floating-animation"></div>
    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-blue-400 to-green-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 floating-animation" style="animation-delay: 2s;"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gradient-to-r from-yellow-400 to-red-400 rounded-full mix-blend-multiply filter blur-xl opacity-10 floating-animation" style="animation-delay: 4s;"></div>
  </div>

  <div class="flex min-h-screen relative z-10">
    
    <!-- Enhanced Sidebar -->
    <aside class="w-72 bg-white/90 backdrop-blur-lg shadow-2xl flex flex-col justify-between border-r border-white/20">
      <div>
        <!-- Logo Section with Glow -->
        <div class="p-6 flex items-center space-x-3 border-b border-gray-100/50">
          <div class="relative">
            <div class="absolute inset-0 bg-red-500 rounded-full blur-sm opacity-75 pulse-ring"></div>
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23ef4444'/%3E%3Ctext x='50' y='55' font-family='Arial' font-size='30' fill='white' text-anchor='middle'%3EE%3C/text%3E%3C/svg%3E" class="w-12 h-12 rounded-full shadow-lg relative z-10">
          </div>
          <div>
            <span class="font-bold text-2xl bg-gradient-to-r from-red-600 to-pink-600 bg-clip-text text-transparent">ERAS</span>
            <div class="text-xs text-gray-500">Emergency Response System</div>
          </div>
        </div>

        <!-- Progress Indicator -->
        <div class="px-6 py-4 border-b border-gray-100/50">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium text-gray-600">Profile Completion</span>
            <span class="text-sm font-bold text-red-600" id="completion-percentage">25%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
            <div class="h-full w-1/4 rounded-full bg-gradient-to-r from-red-500 to-pink-500" id="completion-bar"></div>
          </div>
          <div class="text-xs text-gray-500 mt-1">Complete your profile to unlock all features</div>
        </div>

        <!-- Navigation -->
        <nav class="px-4 py-6 space-y-2">
          <a href="{% url 'homepage' %}" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group">
            <i class="fas fa-home mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i> 
            <span class="font-medium">Home</span>
          </a>
          <div class="sidebar-item flex items-center px-4 py-3 rounded-xl bg-gradient-to-r from-red-500 to-pink-500 text-white font-medium glow-effect">
            <i class="fas fa-user mr-4"></i> Complete Profile
            <span class="ml-auto text-xs bg-white/20 px-2 py-1 rounded-full">Required</span>
          </div>
          <a href="#" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group opacity-50 cursor-not-allowed">
            <i class="fas fa-bell mr-4 text-gray-400"></i> 
            <span class="font-medium">Alerts</span>
            <i class="fas fa-lock ml-auto text-xs text-gray-400"></i>
          </a>
          <a href="#" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group opacity-50 cursor-not-allowed">
            <i class="fas fa-map-marker-alt mr-4 text-gray-400"></i> 
            <span class="font-medium">Emergency Services</span>
            <i class="fas fa-lock ml-auto text-xs text-gray-400"></i>
          </a>
          <a href="#" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group opacity-50 cursor-not-allowed">
            <i class="fas fa-heart mr-4 text-gray-400"></i> 
            <span class="font-medium">Blood Network</span>
            <i class="fas fa-lock ml-auto text-xs text-gray-400"></i>
          </a>
          <a href="#" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group">
            <i class="fas fa-cog mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i> 
            <span class="font-medium">Settings</span>
          </a>
        </nav>
      </div>

      <!-- Logout Section -->
      <div class="p-4 border-t border-gray-100/50">
        <a href="{% url 'logout' %}" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-gray-50 text-gray-700 group w-full">
          <i class="fas fa-sign-out-alt mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i> 
          <span class="font-medium">Log Out</span>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 overflow-y-auto">
      
      <!-- Enhanced Profile Header -->
      <div class="section-card rounded-2xl p-8 mb-8">
        <div class="flex items-center space-x-6">
          <div class="relative group">
            <div class="w-24 h-24 rounded-2xl overflow-hidden shadow-lg bg-gradient-to-br from-red-400 to-pink-500 p-1">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23f3f4f6'/%3E%3Ccircle cx='50' cy='35' r='15' fill='%23ef4444'/%3E%3Cpath d='M25 75 Q25 55 50 55 Q75 55 75 75' fill='%23ef4444'/%3E%3C/svg%3E" alt="Profile" class="w-full h-full object-cover rounded-xl bg-white">
            </div>
            <button class="absolute -bottom-1 -right-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white p-2 rounded-full shadow-lg hover:scale-110 transition-transform">
              <i class="fas fa-camera text-xs"></i>
            </button>
          </div>
          <div class="flex-1">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">
              {{ user.get_full_name|default:user.username }}
            </h2>
            <p class="text-gray-500 mb-2">Citizen Profile</p>
            <div class="flex items-center space-x-4">
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
                <span class="text-sm text-yellow-600 font-medium">Profile Incomplete</span>
              </div>
              <div class="flex items-center space-x-2">
                <i class="fas fa-shield-alt text-blue-500"></i>
                <span class="text-sm text-blue-600 font-medium">Account Verified</span>
              </div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold text-red-600" id="header-completion">25%</div>
            <div class="text-sm text-gray-500">Complete</div>
            <div class="text-xs text-red-600 font-medium mt-1">Profile Required</div>
          </div>
        </div>
      </div>

      <form method="post" class="space-y-8">
        {% csrf_token %}
        
        <!-- Personal Information Section -->
        <div class="section-card rounded-2xl p-8">
          <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-user text-white"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-800">Personal Information</h2>
                <p class="text-gray-500 text-sm">Your account details (cannot be changed here)</p>
              </div>
            </div>
            <div class="completion-status status-complete">
              <i class="fas fa-check-circle"></i>
              <span>Registered</span>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name</label>
              <div class="relative">
                <input type="text" value="{{ user.get_full_name|default:user.username }}" readonly class="readonly-field w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-gray-300 transition-all pl-12">
                <i class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <i class="fas fa-lock locked-icon"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Registered during account creation</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
              <div class="relative">
                <input type="email" value="{{ user.email }}" readonly class="readonly-field w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-gray-300 transition-all pl-12">
                <i class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <i class="fas fa-lock locked-icon"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Primary email for alerts and notifications</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
              <div class="relative">
                <input type="text" value="{{ user.username }}" readonly class="readonly-field w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-gray-300 transition-all pl-12">
                <i class="fas fa-at absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <i class="fas fa-lock locked-icon"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your login username</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number *</label>
              <div class="relative">
                <input type="tel" name="phone_number" value="{{ user.phone_number }}" placeholder="+880 xxx xxx xxxx" required class="w-full h-14 px-4 rounded-xl border-2 border-gray-300 focus:border-red-400 focus:ring-4 focus:ring-red-100 transition-all pl-12">
                <i class="fas fa-phone absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-red-600 mt-1">Required for emergency notifications</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Emergency Contact *</label>
              <div class="relative">
                <input type="tel" name="emergency_contact" value="{{ form.emergency_contact.value|default_if_none:'' }}" placeholder="+880 xxx xxx xxxx" required class="w-full h-14 px-4 rounded-xl border-2 border-gray-300 focus:border-red-400 focus:ring-4 focus:ring-red-100 transition-all pl-12">
                <i class="fas fa-phone-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Alternative contact in emergencies</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Date of Birth *</label>
              <div class="relative">
                <input type="date" name="date_of_birth" value="{{ form.date_of_birth.value|date:'Y-m-d' }}" required class="w-full h-14 px-4 rounded-xl border-2 border-gray-300 focus:border-red-400 focus:ring-4 focus:ring-red-100 transition-all pl-12" max="{{ today|date:'Y-m-d' }}">
                <i class="fas fa-calendar-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Required for age-appropriate alerts</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Blood Group *</label>
              <div class="relative">
                <select name="blood_group" required class="w-full h-14 px-4 rounded-xl border-2 border-gray-300 focus:border-red-400 focus:ring-4 focus:ring-red-100 transition-all pl-12 appearance-none bg-white">
                  <option value="">Select Blood Group</option>
                  <option value="A+" {% if form.blood_group.value == "A+" %}selected{% endif %}>A+</option>
                  <option value="A-" {% if form.blood_group.value == "A-" %}selected{% endif %}>A-</option>
                  <option value="B+" {% if form.blood_group.value == "B+" %}selected{% endif %}>B+</option>
                  <option value="B-" {% if form.blood_group.value == "B-" %}selected{% endif %}>B-</option>
                  <option value="AB+" {% if form.blood_group.value == "AB+" %}selected{% endif %}>AB+</option>
                  <option value="AB-" {% if form.blood_group.value == "AB-" %}selected{% endif %}>AB-</option>
                  <option value="O+" {% if form.blood_group.value == "O+" %}selected{% endif %}>O+</option>
                  <option value="O-" {% if form.blood_group.value == "O-" %}selected{% endif %}>O-</option>
                </select>
                <i class="fas fa-tint absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-red-600 mt-1">Required for blood donation network</p>
            </div>

            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Address</label>
              <div class="relative">
                <textarea name="address" placeholder="Enter your full address" class="w-full h-14 px-4 rounded-xl border-2 border-gray-300 focus:border-red-400 focus:ring-4 focus:ring-red-100 transition-all pl-12 resize-none pt-4">{{ form.address.value|default_if_none:'' }}</textarea>
                <i class="fas fa-map-marker-alt absolute left-4 top-4 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your current residential address</p>
            </div>

            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Location</label>
              <div class="relative">
                <input type="text" name="location" value="{{ form.location.value|default_if_none:'' }}" placeholder="Enter your area/district" class="w-full h-14 px-4 rounded-xl border-2 border-gray-300 focus:border-red-400 focus:ring-4 focus:ring-red-100 transition-all pl-12">
                <i class="fas fa-location-arrow absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your general location for alerts</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-between items-center pt-8 border-t border-gray-200">
          <button type="button" class="flex items-center space-x-2 px-6 py-3 rounded-xl border-2 border-gray-300 text-gray-600 hover:bg-gray-50 transition-all" onclick="window.location.href='{% url 'homepage' %}'">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Home</span>
          </button>
          
          <div class="flex space-x-4">
            <button type="button" class="flex items-center space-x-2 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all">
              <i class="fas fa-save"></i>
              <span>Save Draft</span>
            </button>
            
            <button type="submit" class="flex items-center space-x-2 px-8 py-3 rounded-xl bg-gradient-to-r from-red-500 to-pink-500 text-white font-semibold shadow-lg hover:shadow-xl hover:scale-105 transition-all glow-effect">
              <i class="fas fa-check-circle"></i>
              <span>Complete Profile</span>
            </button>
          </div>
        </div>
      </form>

      <!-- Alert Banner -->
      <div class="mt-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-6 rounded-xl">
        <div class="flex items-start space-x-3">
          <i class="fas fa-exclamation-triangle text-yellow-500 text-xl mt-1"></i>
          <div>
            <h3 class="font-semibold text-gray-800 mb-2">Profile Completion Required</h3>
            <p class="text-gray-700 text-sm mb-3">
              Your profile is incomplete. To receive emergency alerts and access all ERAS features, you must complete the required fields marked with asterisks (*).
            </p>
            <div class="bg-white/50 p-3 rounded-lg border border-yellow-200">
              <p class="text-xs text-gray-600">
                <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                <strong>Note:</strong> Your registered information (name, email, username) cannot be changed through this form. 
                Contact support if you need to update these details.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ===== EXISTING FUNCTIONALITY =====
        // Form field interactions
        document.querySelectorAll('.form-field input, .form-field select, .form-field textarea').forEach(field => {
            field.addEventListener('focus', function() {
                if (!this.readOnly && !this.disabled) {
                    this.closest('.form-field').style.transform = 'translateY(-1px)';
                }
            });
            
            field.addEventListener('blur', function() {
                this.closest('.form-field').style.transform = 'translateY(0)';
            });
        });

        // Update progress based on completed fields
        function updateProgress() {
            const requiredFields = document.querySelectorAll('input[required], select[required], textarea[required]');
            let completed = 0;
            
            requiredFields.forEach(field => {
                if (field.value.trim() !== '') {
                    completed++;
                }
            });
            
            const percentage = Math.round((completed / requiredFields.length) * 100);
            const progressBar = document.getElementById('completion-bar');
            const progressText = document.getElementById('completion-percentage');
            const headerCompletion = document.getElementById('header-completion');
            
            if (progressBar && progressText && headerCompletion) {
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `${percentage}%`;
                headerCompletion.textContent = `${percentage}%`;
            }
        }

        // Add event listeners to required fields
        document.querySelectorAll('input[required], select[required], textarea[required]').forEach(field => {
            field.addEventListener('input', updateProgress);
            field.addEventListener('change', updateProgress);
        });

        // Initial progress calculation
        updateProgress();

        // Form submission validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const requiredFields = this.querySelectorAll('input[required], select[required], textarea[required]');
            let hasEmpty = false;
            
            requiredFields.forEach(field => {
                if (field.value.trim() === '') {
                    hasEmpty = true;
                    field.classList.add('border-red-500');
                    if (!field.classList.contains('readonly-field')) {
                        field.focus();
                    }
                } else {
                    field.classList.remove('border-red-500');
                }
            });
            
            if (hasEmpty) {
                e.preventDefault();
                alert('Please fill in all required fields marked with asterisks (*).');
            }
        });
        
        // ===== NEW FUNCTIONALITY =====
        // Set max date to today for date of birth
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.querySelector('input[name="date_of_birth"]');
        if (dateInput) {
            dateInput.setAttribute('max', today);
            
            // Enhanced date validation
            dateInput.addEventListener('change', function() {
                const selectedDate = new Date(this.value);
                const today = new Date();
                
                if (selectedDate > today) {
                    alert('Date of birth cannot be in the future');
                    this.value = '';
                    this.classList.add('border-red-500');
                } else {
                    this.classList.remove('border-red-500');
                }
                
                // Update progress when date changes
                updateProgress();
            });
        }
        
        // Address same as present address functionality
        const permanentDivisionField = document.querySelector('select[name="permanent_division"]');
        if (permanentDivisionField) {
            const copyAddressCheckbox = document.createElement('div');
            copyAddressCheckbox.innerHTML = `
                <label class="flex items-center mt-2">
                    <input type="checkbox" id="copyAddress" class="mr-2">
                    <span class="text-sm text-gray-600">Same as Present Address</span>
                </label>
            `;
            
            const permanentAddressSection = permanentDivisionField.closest('.form-field');
            if (permanentAddressSection) {
                permanentAddressSection.appendChild(copyAddressCheckbox);
                
                document.getElementById('copyAddress').addEventListener('change', function() {
                    if (this.checked) {
                        // Copy all present address fields to permanent address
                        const fieldsToCopy = ['division', 'district', 'upazila', 'post_office', 'post_code'];
                        fieldsToCopy.forEach(field => {
                            const presentField = document.querySelector(`[name="present_${field}"]`);
                            const permanentField = document.querySelector(`[name="permanent_${field}"]`);
                            if (presentField && permanentField) {
                                permanentField.value = presentField.value;
                            }
                        });
                        
                        // Copy address details
                        const presentDetails = document.querySelector('[name="present_address_details"]');
                        const permanentDetails = document.querySelector('[name="permanent_address_details"]');
                        if (presentDetails && permanentDetails) {
                            permanentDetails.value = presentDetails.value;
                        }
                        
                        // Update progress after copying
                        updateProgress();
                    }
                });
            }
        }
        
        // Auto-format phone numbers
        const phoneInputs = document.querySelectorAll('input[type="tel"]');
        phoneInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.startsWith('880')) {
                    value = '+' + value;
                } else if (value.length > 0 && !value.startsWith('+')) {
                    value = '+880' + value;
                }
                
                // Format with spaces: +880 XXX XXX XXXX
                if (value.length > 4) {
                    value = value.replace(/(\+\d{3})(\d{3})(\d{3})(\d+)/, '$1 $2 $3 $4');
                }
                
                e.target.value = value;
            });
        });
        
    });
</script>
</body>
</html>