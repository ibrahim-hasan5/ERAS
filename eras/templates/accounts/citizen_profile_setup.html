<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complete Your Profile - ERAS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass-morphism {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    
    .gradient-border {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 2px;
      border-radius: 16px;
    }
    
    .gradient-border-content {
      background: white;
      border-radius: 14px;
      padding: 2rem;
    }
    
    .floating-animation {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .glow-effect {
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
    }
    
    .form-field {
      transition: all 0.3s ease;
    }
    
    .form-field:focus-within {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .sidebar-item {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .sidebar-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .sidebar-item:hover::before {
      left: 100%;
    }
    
    .progress-indicator {
      background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6, #ef4444);
      background-size: 400% 400%;
      animation: gradient-shift 8s ease infinite;
    }
    
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .pulse-ring {
      animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
    }
    
    @keyframes pulse-ring {
      0% {
        transform: scale(0.8);
        opacity: 1;
      }
      80%, 100% {
        transform: scale(1.2);
        opacity: 0;
      }
    }
    
    .section-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.4s ease;
    }
    
    .section-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .readonly-field {
      background: #f8fafc !important;
      color: #6b7280;
      cursor: not-allowed;
    }

    .locked-icon {
      color: #9ca3af;
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }

    .completion-status {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      padding: 2px 8px;
      border-radius: 12px;
    }

    .status-incomplete {
      background: #fef3c7;
      color: #d97706;
    }

    .status-complete {
      background: #d1fae5;
      color: #059669;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 font-inter text-gray-800 overflow-x-hidden">
  
  <!-- Animated Background Elements -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 floating-animation"></div>
    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-blue-400 to-green-400 rounded-full mix-blend-multiply filter blur-xl opacity-20 floating-animation" style="animation-delay: 2s;"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gradient-to-r from-yellow-400 to-red-400 rounded-full mix-blend-multiply filter blur-xl opacity-10 floating-animation" style="animation-delay: 4s;"></div>
  </div>

  <div class="flex min-h-screen relative z-10">
    
    <!-- Enhanced Sidebar -->
    <aside class="w-72 bg-white/90 backdrop-blur-lg shadow-2xl flex flex-col justify-between border-r border-white/20">
      <div>
        <!-- Logo Section with Glow -->
        <div class="p-6 flex items-center space-x-3 border-b border-gray-100/50">
          <div class="relative">
            <div class="absolute inset-0 bg-red-500 rounded-full blur-sm opacity-75 pulse-ring"></div>
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23ef4444'/%3E%3Ctext x='50' y='55' font-family='Arial' font-size='30' fill='white' text-anchor='middle'%3EE%3C/text%3E%3C/svg%3E" class="w-12 h-12 rounded-full shadow-lg relative z-10">
          </div>
          <div>
            <span class="font-bold text-2xl bg-gradient-to-r from-red-600 to-pink-600 bg-clip-text text-transparent">ERAS</span>
            <div class="text-xs text-gray-500">Emergency Response System</div>
          </div>
        </div>

        <!-- Progress Indicator -->
        <div class="px-6 py-4 border-b border-gray-100/50">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium text-gray-600">Profile Completion</span>
            <span class="text-sm font-bold text-red-600" id="completion-percentage">25%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
            <div class="h-full w-1/4 rounded-full bg-gradient-to-r from-red-500 to-pink-500" id="completion-bar"></div>
          </div>
          <div class="text-xs text-gray-500 mt-1">Complete your profile to unlock all features</div>
        </div>

        <!-- Navigation -->
      <nav class="px-4 py-6 space-y-2">
          <a href="{% url 'homepage' %}" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group">
              <i class="fas fa-home mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
              <span class="font-medium">Home</span>
          </a>
          <a href="{% url 'citizen_dashboard' %}" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group">
              <i class="fas fa-user mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
              <span class="font-medium">View Profile</span>
          </a>
          <div class="sidebar-item flex items-center px-4 py-3 rounded-xl bg-gradient-to-r from-red-500 to-pink-500 text-white font-medium glow-effect">
              <i class="fas fa-user-edit mr-4"></i> {% if is_setup %}Complete{% else %}Edit{% endif %} Profile
              <span class="ml-auto text-xs bg-white/20 px-2 py-1 rounded-full">{% if is_setup %}Required{% else %}Optional{% endif %}</span>
          </div>
          </nav>
      </div>

      <!-- Logout Section -->
      <div class="p-4 border-t border-gray-100/50">
        <a href="{% url 'logout' %}" class="sidebar-item flex items-center px-4 py-3 rounded-xl hover:bg-gray-50 text-gray-700 group w-full">
          <i class="fas fa-sign-out-alt mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i> 
          <span class="font-medium">Log Out</span>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 overflow-y-auto">
      
      <!-- Enhanced Profile Header -->
      <div class="section-card rounded-2xl p-8 mb-8">
        <div class="flex items-center space-x-6">
          <div class="relative group">
            <div class="w-24 h-24 rounded-2xl overflow-hidden shadow-lg bg-gradient-to-br from-red-400 to-pink-500 p-1">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23f3f4f6'/%3E%3Ccircle cx='50' cy='35' r='15' fill='%23ef4444'/%3E%3Cpath d='M25 75 Q25 55 50 55 Q75 55 75 75' fill='%23ef4444'/%3E%3C/svg%3E" alt="Profile" class="w-full h-full object-cover rounded-xl bg-white">
            </div>
            <button class="absolute -bottom-1 -right-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white p-2 rounded-full shadow-lg hover:scale-110 transition-transform">
              <i class="fas fa-camera text-xs"></i>
            </button>
          </div>
          <div class="flex-1">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">
              {{ user.get_full_name|default:user.username }}
            </h2>
            <p class="text-gray-500 mb-2">Citizen Profile</p>
            <div class="flex items-center space-x-4">
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
                <span class="text-sm text-yellow-600 font-medium">Profile Incomplete</span>
              </div>
              <div class="flex items-center space-x-2">
                <i class="fas fa-shield-alt text-blue-500"></i>
                <span class="text-sm text-blue-600 font-medium">Account Verified</span>
              </div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold text-red-600" id="header-completion">25%</div>
            <div class="text-sm text-gray-500">Complete</div>
            <div class="text-xs text-red-600 font-medium mt-1">Profile Required</div>
          </div>
        </div>
      </div>

      <form method="post" class="space-y-8">
        {% csrf_token %}
        
        <!-- Personal Information Section -->
        <div class="section-card rounded-2xl p-8">
          <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-user text-white"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-800">Personal Information</h2>
                <p class="text-gray-500 text-sm">Your account details (cannot be changed here)</p>
              </div>
            </div>
            <div class="completion-status status-complete">
              <i class="fas fa-check-circle"></i>
              <span>Registered</span>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name</label>
              <div class="relative">
                <input type="text" name="full_name" value="{{ user.get_full_name|default:user.username }}"  class=" w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-gray-300 transition-all pl-12">
                <i class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                
              </div>
              <p class="text-xs text-gray-500 mt-1">You can update your name here</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
              <div class="relative">
                <input type="email" value="{{ user.email }}" readonly class="readonly-field w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-gray-300 transition-all pl-12">
                <i class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <i class="fas fa-lock locked-icon"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Primary email for alerts and notifications</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
              <div class="relative">
                <input type="text" value="{{ user.username }}" readonly class="readonly-field w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-gray-300 transition-all pl-12">
                <i class="fas fa-at absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <i class="fas fa-lock locked-icon"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your login username</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number *</label>
              <div class="relative">
                <input type="tel" name="phone_number" value="{{ user.citizen_profile.phone_number |default:'' }}" placeholder="+880 xxx xxx xxxx" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-phone absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Required for emergency contact</p>
            </div>
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Date of Birth *</label>
              <div class="relative">
                <input type="date" name="date_of_birth" value="{% if user.citizen_profile.date_of_birth %}{{ user.citizen_profile.date_of_birth|date:'Y-m-d' }}{% endif %}" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 
           focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-calendar-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your birth date (age will be auto-calculated)</p>
              <p class="text-sm font-medium text-gray-700 mt-1">Age: <span id="calculated-age">—</span></p>
            </div>

          </div>
        </div>

        <!-- Address Information Section -->
        <div class="section-card rounded-2xl p-8">
          <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-pink-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-home text-white"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-800">Address Information</h2>
                <p class="text-gray-500 text-sm">Required for emergency response</p>
              </div>
            </div>
            <div class="completion-status status-incomplete">
              <i class="fas fa-exclamation-circle"></i>
              <span>Required</span>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">House/Road No. *</label>
              <div class="relative">
                <input type="text" name="house_road_no" placeholder="House #123, Road #456" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-home absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your house and road number</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Area/Sector *</label>
              <div class="relative">
                <input type="text" name="area_sector" placeholder="Gulshan, Banani, etc." class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-map-marker-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your residential area or sector</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">City *</label>
              <div class="relative">
                <input type="text" name="city" placeholder="Dhaka, Chittagong, etc." class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-city absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your city of residence</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Postal Code *</label>
              <div class="relative">
                <input type="text" name="postal_code" placeholder="1212" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-envelope-open-text absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your postal/zip code</p>
            </div>
            
            <div class="form-field md:col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Additional Landmarks</label>
              <div class="relative">
                <textarea name="landmarks" placeholder="Nearby landmarks, building name, etc." class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" rows="3"></textarea>
                <i class="fas fa-map-pin absolute left-4 top-4 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Optional: Additional information to help locate your address</p>
            </div>
          </div>
        </div>

        <!-- Emergency Contact Section -->
        <div class="section-card rounded-2xl p-8">
          <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-phone-alt text-white"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-800">Emergency Contact</h2>
                <p class="text-gray-500 text-sm">Someone to contact in case of emergency</p>
              </div>
            </div>
            <div class="completion-status status-incomplete">
              <i class="fas fa-exclamation-circle"></i>
              <span>Required</span>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Emergency Contact Name *</label>
              <div class="relative">
                <input type="text" name="emergency_contact_name" placeholder="Full name" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-user-friends absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Full name of your emergency contact</p>
            </div>
            
            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Emergency Contact Phone *</label>
              <div class="relative">
                <input type="tel" name="emergency_contact_phone" placeholder="+880 xxx xxx xxxx" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                <i class="fas fa-phone absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Phone number of your emergency contact</p>
            </div>
            
            <div class="form-field md:col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Relationship *</label>
              <div class="relative">
                <select name="emergency_contact_relationship" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" required>
                  <option value="">Select Relationship</option>
                  <option value="parent">Parent</option>
                  <option value="spouse">Spouse</option>
                  <option value="sibling">Sibling</option>
                  <option value="child">Child</option>
                  <option value="friend">Friend</option>
                  <option value="relative">Relative</option>
                  <option value="other">Other</option>
                </select>
                <i class="fas fa-heart absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Relationship to you</p>
            </div>
          </div>
        </div>

        <!-- Medical Information Section -->
        <div class="section-card rounded-2xl p-8">
          <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-heartbeat text-white"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-800">Medical Information</h2>
                <p class="text-gray-500 text-sm">Important for first responders</p>
              </div>
            </div>
            <div class="completion-status status-incomplete">
              <i class="fas fa-exclamation-circle"></i>
              <span>Optional</span>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-field md:col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Blood Type</label>
              <div class="relative">
                <select name="blood_group">
                    <option value="">Select Blood Type</option>
                    <option value="A+" {% if user.citizen_profile.blood_group == 'A+' %}selected{% endif %}>A+</option>
                    <option value="A-" {% if user.citizen_profile.blood_group == 'A-' %}selected{% endif %}>A-</option>
                    <option value="B+" {% if user.citizen_profile.blood_group == 'B+' %}selected{% endif %}>B+</option>
                    <option value="B-" {% if user.citizen_profile.blood_group == 'B-' %}selected{% endif %}>B-</option>
                    <option value="AB+" {% if user.citizen_profile.blood_group == 'AB+' %}selected{% endif %}>AB+</option>
                    <option value="AB-" {% if user.citizen_profile.blood_group == 'AB-' %}selected{% endif %}>AB-</option>
                    <option value="O+" {% if user.citizen_profile.blood_group == 'O+' %}selected{% endif %}>O+</option>
                    <option value="O-" {% if user.citizen_profile.blood_group == 'O-' %}selected{% endif %}>O-</option>

                </select>
                
                <i class="fas fa-tint absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Your blood type (important for emergencies)</p>
            </div>


            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Last Date of Blood Donation</label>
              <div class="relative">
                <input type="date" name="last_blood_donation" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 
           focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12">
                <i class="fas fa-tint absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Leave blank if never donated</p>
            </div>

            <div class="form-field">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Available to Donate?</label>
              <div class="relative">
                <select name="available_to_donate" class="w-full h-14 px-4 rounded-xl border-2 border-gray-200 
            focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12">
                  <option value="">Select Option</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
                <i class="fas fa-hand-holding-heart absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>


            
            <div class="form-field md:col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Known Allergies</label>
              <div class="relative">
                <textarea name="allergies" placeholder="List any known allergies" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" rows="2"></textarea>
                <i class="fas fa-allergies absolute left-4 top-4 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Any allergies that emergency personnel should know about</p>
            </div>
            
            <div class="form-field md:col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Medical Conditions</label>
              <div class="relative">
                <textarea name="medical_conditions" placeholder="List any chronic or serious medical conditions" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all pl-12" rows="2"></textarea>
                <i class="fas fa-stethoscope absolute left-4 top-4 text-gray-400"></i>
              </div>
              <p class="text-xs text-gray-500 mt-1">Any conditions that emergency personnel should know about</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-between items-center mt-8">
          <a href="{% url 'homepage' %}" class="px-8 py-4 rounded-xl font-medium text-gray-600 hover:bg-gray-100 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i> Back to Home
          </a>
          <button type="submit" class="px-8 py-4 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-xl font-medium hover:shadow-lg transition-all">
            Save Profile <i class="fas fa-check ml-2"></i>
          </button>
        </div>
      </form>
    </main>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', function() {

    // --- Function to update profile completion percentage ---
    function updateCompletion() {
      const requiredFields = [
        'phone_number',
        'house_road_no',
        'area_sector',
        'city',
        'postal_code',
        'emergency_contact_name',
        'emergency_contact_phone',
        'emergency_contact_relationship',
        'date_of_birth'   // NEW required field
      ];
      
      let filledCount = 0;
      requiredFields.forEach(field => {
        const element = document.querySelector(`[name="${field}"]`);
        if (element && element.value.trim() !== '') {
          filledCount++;
        }
      });
      
      const completionPercentage = Math.round((filledCount / requiredFields.length) * 100);
      
      // Update progress UI
      document.getElementById('completion-bar').style.width = `${completionPercentage}%`;
      document.getElementById('completion-percentage').textContent = `${completionPercentage}%`;
      document.getElementById('header-completion').textContent = `${completionPercentage}%`;
    }

    // --- Function to auto-calculate Age from DOB ---
    const dobField = document.querySelector('[name="date_of_birth"]');
    if (dobField) {
      dobField.addEventListener('change', function() {
        if (dobField.value) {
          const today = new Date();
          const birthDate = new Date(dobField.value);
          let age = today.getFullYear() - birthDate.getFullYear();
          const m = today.getMonth() - birthDate.getMonth();
          if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
          }
          document.getElementById('calculated-age').textContent = age;
        } else {
          document.getElementById('calculated-age').textContent = '—';
        }
      });
    }

    // --- Optional: Auto-check blood donation availability based on last donation date ---
    const donationDateField = document.querySelector('[name="last_blood_donation"]');
    const availabilityField = document.querySelector('[name="available_to_donate"]');

    if (donationDateField && availabilityField) {
      donationDateField.addEventListener('change', function() {
        if (donationDateField.value) {
          const today = new Date();
          const lastDonation = new Date(donationDateField.value);
          const diffDays = Math.floor((today - lastDonation) / (1000 * 60 * 60 * 24));
          
          // Many guidelines suggest 90 days gap for safe donation
          if (diffDays >= 90) {
            availabilityField.value = "yes";
          } else {
            availabilityField.value = "no";
          }
        }
      });
    }

    // --- Add event listeners to required fields ---
    const requiredFields = document.querySelectorAll('input[required], select[required]');
    requiredFields.forEach(field => {
      field.addEventListener('input', updateCompletion);
      field.addEventListener('change', updateCompletion);
    });

    // --- Initial run ---
    updateCompletion();
  });
</script>

</body>
</html>