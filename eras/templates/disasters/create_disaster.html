{% load disasters_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if is_create %}Report Disaster{% else %}Edit Disaster Report{% endif %} - ERAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .form-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .char-counter {
            font-size: 0.75rem;
            color: #6b7280;
        }
        .char-counter.warning { color: #f59e0b; }
        .char-counter.error { color: #ef4444; }

        .image-preview {
            position: relative;
            display: inline-block;
        }
        .image-preview img {
            max-width: 150px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }
        .image-preview .remove-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-red-50 via-white to-orange-50 font-inter text-gray-800">

    <!-- Animated Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-red-400 to-pink-400 rounded-full mix-blend-multiply filter blur-xl opacity-20"></div>
        <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-orange-400 to-red-400 rounded-full mix-blend-multiply filter blur-xl opacity-20"></div>
    </div>

    <div class="flex min-h-screen relative z-10">

        <!-- Sidebar -->
        <aside class="w-72 bg-white/90 backdrop-blur-lg shadow-2xl flex flex-col justify-between border-r border-white/20">
            <div>
                <div class="p-6 flex items-center space-x-3 border-b border-gray-100/50">
                    <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-full flex items-center justify-center shadow-lg">
                        <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                    </div>
                    <div>
                        <span class="font-bold text-2xl bg-gradient-to-r from-red-600 to-pink-600 bg-clip-text text-transparent">ERAS</span>
                        <div class="text-xs text-gray-500">Disaster Reporting</div>
                    </div>
                </div>

                <nav class="px-4 py-6 space-y-2">
                    <a href="{% url 'homepage' %}" class="flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group transition-colors">
                        <i class="fas fa-home mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
                        <span class="font-medium">Home</span>
                    </a>
                    {% if user.user_type == 'citizen' %}
                    <a href="{% url 'citizen_dashboard' %}" class="flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group transition-colors">
                        <i class="fas fa-user mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    {% elif user.user_type == 'service_provider' %}
                    <a href="{% url 'service_provider_dashboard' %}" class="flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group transition-colors">
                        <i class="fas fa-hospital mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    {% endif %}
                    <a href="{% url 'disasters:my_disasters' %}" class="flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group transition-colors">
                        <i class="fas fa-list mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
                        <span class="font-medium">My Reports</span>
                    </a>
                    <a href="{% url 'disasters:disaster_list' %}" class="flex items-center px-4 py-3 rounded-xl hover:bg-red-50 text-gray-700 group transition-colors">
                        <i class="fas fa-globe mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
                        <span class="font-medium">All Disasters</span>
                    </a>
                </nav>
            </div>

            <div class="p-4 border-t border-gray-100/50">
                <a href="{% url 'logout' %}" class="flex items-center px-4 py-3 rounded-xl hover:bg-gray-50 text-gray-700 group w-full transition-colors">
                    <i class="fas fa-sign-out-alt mr-4 text-gray-400 group-hover:text-red-500 transition-colors"></i>
                    <span class="font-medium">Log Out</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-y-auto">

            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    {% if is_create %}Report New Disaster{% else %}Edit Disaster Report{% endif %}
                </h1>
                <p class="text-gray-600">
                    {% if is_create %}
                        Provide detailed information about the emergency situation to help coordinate response efforts.
                    {% else %}
                        Update the disaster report information. Changes will be reviewed before becoming public.
                    {% endif %}
                </p>
            </div>

           <!-- Update the Progress Indicator section -->
<div class="mb-8">
    <div class="flex items-center space-x-4 text-sm">
        <div class="flex items-center text-red-600">
            <div class="w-6 h-6 bg-red-600 rounded-full flex items-center justify-center text-white text-xs font-bold mr-2">1</div>
            Report Details
        </div>
        <div class="flex-1 h-0.5 bg-gray-200"></div>
        <div class="flex items-center text-green-600">
            <div class="w-6 h-6 bg-green-600 rounded-full flex items-center justify-center text-white text-xs font-bold mr-2">2</div>
            Published Live
        </div>
    </div>
</div>

            <!-- Form -->
            <form method="post" enctype="multipart/form-data" id="disasterForm" class="space-y-8">
                {% csrf_token %}

                <!-- Basic Information Section -->
                <div class="form-section rounded-2xl p-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-info-circle text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Basic Information</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Disaster Type *</label>
                            {{ form.disaster_type }}
                            {% if form.disaster_type.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.disaster_type.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Severity Level *</label>
                            {{ form.severity }}
                            {% if form.severity.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.severity.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="md:col-span-2">
                             <label class="block text-sm font-medium text-gray-700 mb-2">
                               Title <span class="text-gray-400">(Optional)</span>
                             </label>
                             {{ form.title }}
                             <p class="text-xs text-gray-500 mt-1">Leave blank for auto-generated title</p>
                               {% if form.title.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.title.errors.0 }}</p>
                             {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Location Section -->
                <div class="form-section rounded-2xl p-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-map-marker-alt text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Location Details</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">City *</label>
                            {{ form.city }}
                            {% if form.city.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.city.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Area/Sector *</label>
                            {{ form.area_sector }}
                            {% if form.area_sector.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.area_sector.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Specific Address</label>
                            {{ form.specific_address }}
                            {% if form.specific_address.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.specific_address.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nearby Landmarks</label>
                            {{ form.landmarks }}
                            {% if form.landmarks.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.landmarks.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Timing Section -->
                <div class="form-section rounded-2xl p-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">When Did This Happen?</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Incident Date *</label>
                            {{ form.incident_date }}
                            {% if form.incident_date.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.incident_date.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Incident Time *</label>
                            {{ form.incident_time }}
                            {% if form.incident_time.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.incident_time.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Description Section -->
                <div class="form-section rounded-2xl p-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-file-alt text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Description</h2>
                    </div>

                  <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Detailed Description *</label>
                      {{ form.description }}
                     <div class="flex justify-between items-center mt-2">
                        <p class="text-xs text-gray-500">Provide brief details about the disaster (maximum 50 characters)</p>
                     <div class="char-counter" id="charCounter">0/50 maximum</div>
                    </div>
                     {% if form.description.errors %}
                     <p class="text-red-500 text-sm mt-1">{{ form.description.errors.0 }}</p>
                       {% endif %}
                   </div>
                </div>

                <!-- Images Section -->
                <div class="form-section rounded-2xl p-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-blue-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-images text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Images (Optional)</h2>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-info-circle text-blue-500 mt-1"></i>
                                <div class="text-sm text-blue-700">
                                    <p class="font-medium mb-1">Image Guidelines:</p>
                                    <ul class="list-disc list-inside space-y-1 text-xs">
                                        <li>Maximum 5 images allowed</li>
                                        <li>Each image must be under 5MB</li>
                                        <li>Supported formats: JPEG, PNG, WebP</li>
                                        <li>Only upload appropriate content related to the disaster</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div id="imageFormset">
                            {{ image_formset.management_form }}
                            {% for form in image_formset %}
                                <div class="image-form-row border border-gray-200 rounded-lg p-4 mb-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Image</label>
                                            {{ form.image }}
                                            {% if form.image.errors %}
                                                <p class="text-red-500 text-sm mt-1">{{ form.image.errors.0 }}</p>
                                            {% endif %}
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Caption</label>
                                            {{ form.caption }}
                                            {% if form.caption.errors %}
                                                <p class="text-red-500 text-sm mt-1">{{ form.caption.errors.0 }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mt-4 flex items-center justify-between">
                                        <div class="flex items-center">
                                            {{ form.is_primary }}
                                            <label class="ml-2 text-sm text-gray-700">Set as primary image</label>
                                        </div>
                                        {% if not is_create %}
                                            <button type="button" class="text-red-500 hover:text-red-700 text-sm font-medium remove-image-btn">
                                                <i class="fas fa-trash mr-1"></i> Remove
                                            </button>
                                        {% endif %}
                                    </div>

                                    <!-- Hidden delete field -->
                                    {% if form.DELETE %}
                                        {{ form.DELETE }}
                                    {% endif %}

                                    <!-- Image preview -->
                                    <div class="image-preview-container mt-4" style="display: none;">
                                        <img class="preview-img rounded-lg shadow-sm" />
                                        <button type="button" class="remove-preview-btn absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <button type="button" id="addImageBtn" class="w-full py-3 px-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-gray-600 hover:text-blue-600">
                            <i class="fas fa-plus mr-2"></i> Add Another Image
                        </button>
                    </div>
                </div>

                <!-- Contact Section -->
                <div class="form-section rounded-2xl p-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-blue-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-phone text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Contact Information</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Reporter Contact</label>
                            <input type="text" value="{{ user.phone_number|default:user.email }}" disabled
                                   class="w-full px-4 py-2 bg-gray-100 border border-gray-200 rounded-lg text-gray-600">
                            <p class="text-xs text-gray-500 mt-1">Your contact information from profile</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Emergency Contact on Scene (Optional)</label>
                            {{ form.emergency_contact }}
                            <p class="text-xs text-gray-500 mt-1">Contact number of someone at the scene</p>
                            {% if form.emergency_contact.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ form.emergency_contact.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-8">
                    <button type="submit" name="submit"
                            class="flex-1 bg-gradient-to-r from-red-500 to-pink-500 text-white py-4 px-8 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-paper-plane mr-2"></i>
                        {% if is_create %}Submit{% else %}Update Report{% endif %}
                    </button>

                    <button type="submit" name="save_draft"
                            class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white py-4 px-8 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-save mr-2"></i>
                        Save as Draft
                    </button>

                    <a href="{% if is_create %}{% url 'disasters:my_disasters' %}{% else %}{% url 'disasters:disaster_detail' disaster.id %}{% endif %}"
                       class="flex-1 bg-white border-2 border-gray-300 text-gray-700 py-4 px-8 rounded-xl font-semibold hover:border-gray-400 hover:shadow-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-times mr-2"></i>
                        Cancel
                    </a>
                </div>
            </form>
        </main>
    </div>

    <script>
    // Character counter for description
    function updateCharCount(textarea) {
        const counter = document.getElementById('charCounter');
        const length = textarea.value.length;

        counter.textContent = `${length}/50 maximum`;
        counter.className = 'char-counter';

        if (length > 50) {
            counter.classList.add('error');
            textarea.classList.add('border-red-500');
        } else if (length > 40) {
            counter.classList.add('warning');
            textarea.classList.remove('border-red-500');
        } else {
            textarea.classList.remove('border-red-500');
        }
    }

    // Initialize character counter
    const descriptionField = document.querySelector('[name="description"]');
    if (descriptionField) {
        descriptionField.addEventListener('input', function() {
            updateCharCount(this);
        });
        updateCharCount(descriptionField);
    }

    // Dynamic area/sector loading
    async function updateAreaOptions(city) {
        const areaSelect = document.querySelector('[name="area_sector"]');
        if (!city || !areaSelect) return;

        try {
            const response = await fetch(`{% url 'disasters:get_areas_by_city' %}?city=${encodeURIComponent(city)}`);
            const data = await response.json();

            // Clear existing options
            areaSelect.innerHTML = '<option value="">Select Area/Sector</option>';

            // Add new options
            data.areas.forEach(area => {
                const option = document.createElement('option');
                option.value = area.value;
                option.textContent = area.label;
                areaSelect.appendChild(option);
            });
        } catch (error) {
            console.error('Error loading areas:', error);
        }
    }

    // City change handler
    const citySelect = document.querySelector('[name="city"]');
    if (citySelect) {
        citySelect.addEventListener('change', function() {
            updateAreaOptions(this.value);
        });
    }

    // ===== FIX: Add Another Image Button =====
    let formCount = parseInt(document.querySelector('[name="form-TOTAL_FORMS"]').value);
    const maxForms = 5;

    document.getElementById('addImageBtn').addEventListener('click', function() {
        if (formCount >= maxForms) {
            alert('You can only upload a maximum of 5 images.');
            return;
        }

        const formsetContainer = document.getElementById('imageFormset');
        const lastForm = document.querySelector('.image-form-row:last-of-type');

        // Clone the last form
        const newForm = lastForm.cloneNode(true);

        // Update form count
        formCount++;

        // Update the form index in all fields
        const formRegex = new RegExp(`form-(\\d+)-`, 'g');
        newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formCount - 1}-`);

        // Clear the input values
        newForm.querySelectorAll('input[type="file"]').forEach(input => {
            input.value = '';
        });
        newForm.querySelectorAll('input[type="text"]').forEach(input => {
            input.value = '';
        });
        newForm.querySelectorAll('input[type="checkbox"]').forEach(input => {
            input.checked = false;
        });

        // Hide image preview
        const previewContainer = newForm.querySelector('.image-preview-container');
        if (previewContainer) {
            previewContainer.style.display = 'none';
        }

        // Insert before the add button
        this.parentElement.insertBefore(newForm, this);

        // Update total forms count
        document.querySelector('[name="form-TOTAL_FORMS"]').value = formCount;
    });

    // Image preview functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Attach event listeners to image inputs
        attachImagePreviewListeners();
    });

    function attachImagePreviewListeners() {
        document.querySelectorAll('input[type="file"]').forEach(input => {
            // Remove existing listeners to avoid duplicates
            input.removeEventListener('change', handleImageChange);
            input.addEventListener('change', handleImageChange);
        });
    }

    function handleImageChange(e) {
        const file = e.target.files[0];
        if (file) {
            // Validate file size
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size cannot exceed 5MB.');
                e.target.value = '';
                return;
            }

            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('Only JPEG, PNG, and WebP images are allowed.');
                e.target.value = '';
                return;
            }

            const reader = new FileReader();
            const previewContainer = this.closest('.image-form-row').querySelector('.image-preview-container');
            const previewImg = previewContainer.querySelector('.preview-img');

            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewContainer.style.display = 'block';
            };

            reader.readAsDataURL(file);
        }
    }

    // Remove image preview
    document.addEventListener('click', function(e) {
        if (e.target.matches('.remove-preview-btn') || e.target.closest('.remove-preview-btn')) {
            const row = e.target.closest('.image-form-row');
            const input = row.querySelector('input[type="file"]');
            const previewContainer = row.querySelector('.image-preview-container');

            input.value = '';
            previewContainer.style.display = 'none';
        }
    });

    // Remove image form row
    document.addEventListener('click', function(e) {
        if (e.target.matches('.remove-image-btn') || e.target.closest('.remove-image-btn')) {
            const row = e.target.closest('.image-form-row');
            const deleteField = row.querySelector('input[name$="-DELETE"]');

            if (deleteField) {
                deleteField.checked = true;
                row.style.display = 'none';
            } else {
                // If no delete field, just remove the row
                row.remove();
                formCount--;
                document.querySelector('[name="form-TOTAL_FORMS"]').value = formCount;
            }
        }
    });

    // Primary image selection (only one allowed)
    document.addEventListener('change', function(e) {
        if (e.target.matches('input[name$="-is_primary"]')) {
            if (e.target.checked) {
                // Uncheck all other primary checkboxes
                document.querySelectorAll('input[name$="-is_primary"]').forEach(checkbox => {
                    if (checkbox !== e.target) {
                        checkbox.checked = false;
                    }
                });
            }
        }
    });

    // Form validation
    document.getElementById('disasterForm').addEventListener('submit', function(e) {
        const requiredFields = [
            'disaster_type', 'severity', 'city', 'area_sector',
            'description', 'incident_date', 'incident_time'
        ];

        let isValid = true;
        const errors = [];

        requiredFields.forEach(fieldName => {
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field && !field.value.trim()) {
                isValid = false;
                errors.push(`${fieldName.replace('_', ' ').toUpperCase()} is required`);
                field.classList.add('border-red-500');
            } else if (field) {
                field.classList.remove('border-red-500');
            }
        });

        // Validate description length
        const description = document.querySelector('[name="description"]');
        if (description && description.value.trim().length > 50) {
            isValid = false;
            errors.push('Description must be 50 characters or less');
            description.classList.add('border-red-500');
            alert('Description must be 50 characters or less.');
            description.focus();
            e.preventDefault();
            return false;
        }

        if (description && description.value.trim().length < 10) {
            isValid = false;
            errors.push('Description must be at least 10 characters');
            description.classList.add('border-red-500');
            alert('Description must be at least 10 characters.');
            description.focus();
            e.preventDefault();
            return false;
        }

        if (!isValid) {
            e.preventDefault();
            alert('Please fix the following errors:\n\n' + errors.join('\n'));
            // Scroll to first error
            const firstError = document.querySelector('.border-red-500');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            return false;
        }
    });
</script>
</body>
</html>